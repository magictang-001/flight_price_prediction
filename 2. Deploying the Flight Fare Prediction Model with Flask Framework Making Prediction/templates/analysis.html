<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š èˆªç­ä»·æ ¼åˆ†æ</title>
    <!-- BootStrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <!-- css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        .chart-container {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .chart-img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
        }
        .page-header {
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <!-- As a heading -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/">âœˆï¸ èˆªç­ä»·æ ¼é¢„æµ‹</a>
            </div>
        </div>
    </nav>

    <br><br><br>

    <div class="container">
        <h1 class="page-header float-animation">ğŸ“Š èˆªç­ä»·æ ¼åˆ†æä»ªè¡¨æ¿</h1>
        
        <div class="row">
            <div class="col-12 chart-container">
                <h3>ğŸ›©ï¸ å„èˆªç©ºå…¬å¸å¹³å‡èˆªç­ä»·æ ¼</h3>
                <canvas id="airlineChart"></canvas>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12 chart-container">
                <h3>ğŸ“… å„æœˆå¹³å‡èˆªç­ä»·æ ¼</h3>
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12 chart-container">
                <h3>ğŸŒ å‡ºå‘åœ°å’Œç›®çš„åœ°å¹³å‡ä»·æ ¼ï¼ˆTop 15 è·¯çº¿ï¼‰</h3>
                <canvas id="routeChart"></canvas>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6 chart-container">
                <h3>ğŸ§³ ä¸åŒç»åœæ¬¡æ•°çš„å¹³å‡èˆªç­ä»·æ ¼</h3>
                <canvas id="stopsChart"></canvas>
            </div>
            <div class="col-md-6 chart-container">
                <h3>ğŸ’° èˆªç­ä»·æ ¼åˆ†å¸ƒ</h3>
                <canvas id="distChart"></canvas>
            </div>
        </div>
        
        <div class="row mt-5">
            <div class="col-12 text-center">
                <a href="/model_analysis" class="btn btn-success btn-lg">ğŸ§  æ¨¡å‹åˆ†æ</a>
                <a href="/" class="btn btn-primary btn-lg">ğŸ  è¿”å›é¢„æµ‹</a>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        async function loadData() {
            const res = await fetch('/analysis/data');
            const data = await res.json();
            const airlineLabels = data.airline_prices.map(x => x.airline);
            const airlineValues = data.airline_prices.map(x => x.avg_price);
            new Chart(document.getElementById('airlineChart'), {
                type: 'bar',
                data: { labels: airlineLabels, datasets: [{ label: 'å¹³å‡ä»·æ ¼', data: airlineValues, backgroundColor: '#4e79a7' }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { ticks: { autoSkip: false, maxRotation: 60, minRotation: 0 } } } }
            });
            const monthLabels = Array.from({length: 12}, (_, i) => 'M' + (i + 1));
            const monthMap = new Map(data.monthly_prices.map(x => [x.month, x.avg_price]));
            const monthValues = Array.from({length: 12}, (_, i) => monthMap.get(i + 1) ?? 0);
            new Chart(document.getElementById('monthlyChart'), {
                type: 'line',
                data: { labels: monthLabels, datasets: [{ label: 'å¹³å‡ä»·æ ¼', data: monthValues, borderColor: '#f28e2b', backgroundColor: 'rgba(242,142,43,0.2)', fill: true }] },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
            const routeLabels = data.source_dest_prices.map(x => x.route);
            const routeValues = data.source_dest_prices.map(x => x.avg_price);
            new Chart(document.getElementById('routeChart'), {
                type: 'bar',
                data: { labels: routeLabels, datasets: [{ label: 'å¹³å‡ä»·æ ¼', data: routeValues, backgroundColor: '#59a14f' }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { ticks: { autoSkip: false, maxRotation: 60 } } } }
            });
            const stopsLabels = data.stops_prices.map(x => String(x.stops));
            const stopsValues = data.stops_prices.map(x => x.avg_price);
            new Chart(document.getElementById('stopsChart'), {
                type: 'bar',
                data: { labels: stopsLabels, datasets: [{ label: 'å¹³å‡ä»·æ ¼', data: stopsValues, backgroundColor: '#e15759' }] },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
            const bins = data.price_distribution.bins;
            const counts = data.price_distribution.counts;
            const binLabels = [];
            for (let i = 0; i < bins.length - 1; i++) {
                binLabels.push(`${Math.round(bins[i])}-${Math.round(bins[i+1])}`);
            }
            new Chart(document.getElementById('distChart'), {
                type: 'bar',
                data: { labels: binLabels, datasets: [{ label: 'é¢‘æ•°', data: counts, backgroundColor: '#b6992d' }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { ticks: { autoSkip: true, maxRotation: 60 } } } }
            });
        }
        loadData();
    </script>
</body>
</html>
