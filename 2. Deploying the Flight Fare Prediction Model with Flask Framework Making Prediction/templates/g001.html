<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹ç©¹å¤–å– - ç³»ç»Ÿæ¶æ„ä¸åŠŸèƒ½äº¤äº’æ¦‚è§ˆ (AI Powered)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }

        /* Chart Container Styling - Mandatory Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .nav-item.active {
            background-color: #0ea5e9; /* Sky-500 */
            color: white;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb;
            transform: translateX(-50%);
            z-index: 0;
        }

        .feature-card {
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #0ea5e9;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Chosen Palette: Sky Blue & Fresh Orange (Professional, Clean, Food-Industry related) -->
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-cloud text-sky-500 text-2xl mr-3"></i>
                    <span class="font-bold text-xl tracking-tight text-slate-800">è‹ç©¹å¤–å– <span class="text-xs font-normal text-slate-500 ml-2">System Explorer + AI âœ¨</span></span>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="switchView('dashboard')" class="nav-item active px-3 py-2 rounded-md text-sm font-medium transition-colors">æ€»è§ˆ</button>
                    <button onclick="switchView('features')" class="nav-item px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:text-sky-500 transition-colors">åŠŸèƒ½æ¨¡å—</button>
                    <button onclick="switchView('technical')" class="nav-item px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:text-sky-500 transition-colors">æŠ€æœ¯äº®ç‚¹</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">

        <!-- View: Dashboard -->
        <div id="dashboard-view" class="space-y-8 animate-fade-in">
            <!-- Hero Section -->
            <div class="text-center mb-10">
                <h1 class="text-4xl font-extrabold text-slate-800 mb-4">é¡¹ç›®åŠŸèƒ½æ¶æ„è§£æ</h1>
                <p class="text-lg text-slate-600 max-w-3xl mx-auto">
                    åŸºäº Spring Boot å¼€å‘çš„å…¨åŠŸèƒ½å¤–å–ç‚¹é¤ç³»ç»Ÿåç«¯ã€‚
                    <br>
                    æ ¸å¿ƒæœåŠ¡äº <span class="font-bold text-sky-600">å•†å®¶ç®¡ç†ç«¯</span> ä¸ <span class="font-bold text-orange-500">é¡¾å®¢å°ç¨‹åºç«¯</span>ã€‚
                </p>
            </div>

            <!-- Top Stats/Summary -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="glass-panel p-6 rounded-xl border-l-4 border-sky-500">
                    <div class="text-slate-500 text-sm font-semibold uppercase">æ ¸å¿ƒæ¡†æ¶</div>
                    <div class="text-2xl font-bold text-slate-800 mt-1">Spring Boot</div>
                    <div class="text-xs text-slate-400 mt-2">Spring MVC + MyBatis</div>
                </div>
                <div class="glass-panel p-6 rounded-xl border-l-4 border-indigo-500">
                    <div class="text-slate-500 text-sm font-semibold uppercase">æ•°æ®åº“</div>
                    <div class="text-2xl font-bold text-slate-800 mt-1">MySQL + Redis</div>
                    <div class="text-xs text-slate-400 mt-2">æŒä¹…åŒ–ä¸ç¼“å­˜æ”¯æŒ</div>
                </div>
                <div class="glass-panel p-6 rounded-xl border-l-4 border-orange-500">
                    <div class="text-slate-500 text-sm font-semibold uppercase">äº¤äº’æŠ€æœ¯</div>
                    <div class="text-2xl font-bold text-slate-800 mt-1">WebSocket</div>
                    <div class="text-xs text-slate-400 mt-2">å®æ—¶æ¥å•ä¸å‚¬å•æé†’</div>
                </div>
                <div class="glass-panel p-6 rounded-xl border-l-4 border-purple-500">
                    <div class="text-slate-500 text-sm font-semibold uppercase">AI å¢å¼º</div>
                    <div class="text-2xl font-bold text-slate-800 mt-1">Gemini API</div>
                    <div class="text-xs text-slate-400 mt-2">æ™ºèƒ½åˆ†æä¸æ¨è</div>
                </div>
            </div>

            <!-- Visualization Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Tech Stack Chart -->
                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fa-solid fa-layer-group mr-2 text-sky-500"></i> æŠ€æœ¯æ ˆæ„æˆ
                    </h3>
                    <div class="chart-container">
                        <canvas id="techStackChart"></canvas>
                    </div>
                    <p class="text-sm text-slate-500 mt-4 text-center">
                        ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œé›†æˆäº†å¤šç§ä¸­é—´ä»¶ä»¥æ”¯æŒé«˜å¹¶å‘ä¸å®æ—¶æ€§ã€‚
                    </p>
                </div>

                <!-- Roles Interaction Flow -->
                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fa-solid fa-users-gear mr-2 text-orange-500"></i> åŒç«¯äº¤äº’æ¨¡å‹
                    </h3>
                    <div class="flex flex-col h-full justify-center space-y-6">
                        <div class="flex items-center justify-between bg-sky-50 p-4 rounded-lg border border-sky-100 cursor-pointer hover:bg-sky-100 transition-colors" onclick="showDetail('admin-detail')">
                            <div class="flex items-center">
                                <div class="bg-sky-500 text-white p-3 rounded-full mr-4">
                                    <i class="fa-solid fa-user-tie"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800">ç®¡ç†ç«¯ (å•†å®¶)</h4>
                                    <p class="text-xs text-slate-500">Webåå°: ç»´æŠ¤æ•°æ®, å¤„ç†è®¢å•, æŸ¥çœ‹æŠ¥è¡¨</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-sky-300"></i>
                        </div>

                        <div class="flex justify-center">
                            <i class="fa-solid fa-arrow-down-up text-slate-300"></i>
                        </div>

                        <div class="flex items-center justify-between bg-orange-50 p-4 rounded-lg border border-orange-100 cursor-pointer hover:bg-orange-100 transition-colors" onclick="showDetail('user-detail')">
                            <div class="flex items-center">
                                <div class="bg-orange-500 text-white p-3 rounded-full mr-4">
                                    <i class="fa-solid fa-mobile-screen"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800">ç”¨æˆ·ç«¯ (Cç«¯)</h4>
                                    <p class="text-xs text-slate-500">å¾®ä¿¡å°ç¨‹åº: ç‚¹é¤, æ”¯ä»˜, å‚¬å•</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-orange-300"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dynamic Info Box for Dashboard Clicks -->
            <div id="detail-box" class="hidden glass-panel p-6 rounded-xl border-l-4 border-slate-500 bg-slate-50 mt-4">
                <h4 id="detail-title" class="font-bold text-lg mb-2">è¯¦æƒ…</h4>
                <p id="detail-content" class="text-slate-600"></p>
            </div>
        </div>

        <!-- View: Functional Modules -->
        <div id="features-view" class="hidden space-y-8 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800">æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ä¸ AI æ¼”ç¤º</h2>
                <div class="bg-white p-1 rounded-lg shadow-sm mt-4 md:mt-0">
                    <button id="btn-admin" onclick="toggleFeature('admin')" class="px-4 py-2 rounded-md text-sm font-medium bg-sky-500 text-white shadow-sm transition-all">ç®¡ç†ç«¯åŠŸèƒ½</button>
                    <button id="btn-user" onclick="toggleFeature('user')" class="px-4 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 transition-all">ç”¨æˆ·ç«¯åŠŸèƒ½</button>
                </div>
            </div>

            <!-- Admin Features Grid -->
            <div id="admin-features" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards generated by JS -->
            </div>

            <!-- User Features Grid -->
            <div id="user-features" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards generated by JS -->
            </div>

            <!-- AI Section: Dynamic Content Area -->
            <!-- This section changes based on whether 'Admin' or 'User' is selected above -->

            <!-- ADMIN AI: Operational Insights -->
            <div id="admin-ai-section" class="mt-12 pt-8 border-t border-slate-200">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800 mb-2">ğŸ“Š æ•°æ®ç»Ÿè®¡ (ReportController)</h3>
                        <p class="text-slate-500 text-sm">ç³»ç»Ÿæä¾›ç»è¥æ•°æ®å¯è§†åŒ–ï¼ŒåŒ…æ‹¬è¥ä¸šé¢ã€è®¢å•ç»Ÿè®¡åŠé”€é‡æ’åã€‚ä¸‹å›¾ä¸ºç³»ç»Ÿç”Ÿæˆçš„æ¨¡æ‹Ÿ Top 10 é”€é‡æŠ¥è¡¨ã€‚</p>
                    </div>
                    <button onclick="generateAdminInsights()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow-md transition-colors flex items-center text-sm font-medium">
                        <span id="admin-ai-btn-text">âœ¨ ç”Ÿæˆæ™ºèƒ½è¿è¥åˆ†æ</span>
                        <div id="admin-ai-loader" class="loader ml-2 hidden"></div>
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="glass-panel p-6 rounded-xl col-span-2">
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                    <!-- Analysis Result Area -->
                    <div class="glass-panel p-6 rounded-xl bg-purple-50 border border-purple-100 flex flex-col">
                        <h4 class="font-bold text-purple-900 mb-4 flex items-center"><i class="fa-solid fa-lightbulb mr-2"></i> AI æ´å¯ŸæŠ¥å‘Š</h4>
                        <div id="admin-ai-output" class="text-sm text-purple-800 leading-relaxed flex-grow overflow-y-auto">
                            ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œè®© Gemini åˆ†æå·¦ä¾§çš„é”€å”®æ•°æ®å¹¶æä¾›ç»è¥å»ºè®®...
                        </div>
                    </div>
                </div>
            </div>

            <!-- USER AI: Smart Dish Recommender -->
            <div id="user-ai-section" class="hidden mt-12 pt-8 border-t border-slate-200">
                <h3 class="text-xl font-bold text-slate-800 mb-4">ğŸ¤– æ™ºèƒ½ç‚¹é¤åŠ©æ‰‹ (User AI Demo)</h3>
                <div class="glass-panel p-8 rounded-xl bg-gradient-to-r from-orange-50 to-white border border-orange-100">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div>
                            <h4 class="font-bold text-lg text-slate-800 mb-2">ä¸çŸ¥é“åƒä»€ä¹ˆï¼Ÿ</h4>
                            <p class="text-slate-600 text-sm mb-4">
                                è¾“å…¥æ‚¨çš„å£å‘³åå¥½ï¼ˆä¾‹å¦‚ï¼šâ€œæƒ³åƒè¾£çš„â€ã€â€œæ¸…æ·¡ä¸€ç‚¹â€æˆ–â€œé€‚åˆä¸¤ä¸ªäººçš„å¥—é¤â€ï¼‰ï¼Œè®© AI åŸºäºå½“å‰èœå•ä¸ºæ‚¨æ¨èã€‚
                            </p>
                            <div class="flex space-x-2">
                                <input type="text" id="user-preference-input" placeholder="è¾“å…¥æ‚¨çš„å£å‘³åå¥½..." class="flex-grow px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm">
                                <button onclick="getDishRecommendation()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg shadow-md transition-colors flex items-center text-sm font-medium whitespace-nowrap">
                                    <span id="user-ai-btn-text">âœ¨ AI æ¨è</span>
                                    <div id="user-ai-loader" class="loader ml-2 border-white border-t-orange-600 hidden"></div>
                                </button>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-inner border border-slate-100 min-h-[120px] relative">
                            <div class="absolute top-2 left-2 text-xs text-slate-300 uppercase font-bold">æ¨èç»“æœ</div>
                            <div id="user-ai-output" class="mt-4 text-sm text-slate-700 leading-relaxed">
                                è¯·åœ¨å·¦ä¾§è¾“å…¥åå¥½ï¼Œç­‰å¾… AI æ¨è...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- View: Technical Highlights -->
        <div id="technical-view" class="hidden space-y-8 animate-fade-in">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">å…³é”®ä¸šåŠ¡é€»è¾‘ä¸æŠ€æœ¯äº®ç‚¹</h2>

            <!-- Interactive Order Flow -->
            <div class="glass-panel p-8 rounded-xl">
                <h3 class="text-lg font-bold text-slate-800 mb-6">ğŸ”„ è®¢å•å…¨ç”Ÿå‘½å‘¨æœŸå¤„ç†æµç¨‹</h3>
                <div class="relative">
                    <div class="absolute left-4 top-0 bottom-0 w-1 bg-slate-200"></div>
                    <div class="space-y-8 pl-12" id="order-flow-container">
                        <!-- Steps generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Tech Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-panel p-6 rounded-xl bg-gradient-to-br from-white to-sky-50">
                    <div class="text-sky-500 text-3xl mb-4"><i class="fa-solid fa-stopwatch"></i></div>
                    <h4 class="font-bold text-lg mb-2">Spring Task å®šæ—¶ä»»åŠ¡</h4>
                    <ul class="text-sm text-slate-600 list-disc list-inside space-y-1">
                        <li>æ¯åˆ†é’Ÿæ£€æŸ¥è¶…æ—¶æœªæ”¯ä»˜è®¢å• (15min)</li>
                        <li>æ¯æ—¥å‡Œæ™¨è‡ªåŠ¨å®Œæˆæ´¾é€ä¸­è®¢å•</li>
                        <li>ç¡®ä¿æ•°æ®æœ€ç»ˆä¸€è‡´æ€§</li>
                    </ul>
                </div>

                <div class="glass-panel p-6 rounded-xl bg-gradient-to-br from-white to-indigo-50">
                    <div class="text-indigo-500 text-3xl mb-4"><i class="fa-solid fa-robot"></i></div>
                    <h4 class="font-bold text-lg mb-2">AOP è‡ªåŠ¨å¡«å……</h4>
                    <p class="text-sm text-slate-600 mb-2">è‡ªå®šä¹‰æ³¨è§£ <code>@AutoFill</code></p>
                    <p class="text-sm text-slate-600">
                        è‡ªåŠ¨æ‹¦æˆª INSERT/UPDATE æ“ä½œï¼Œç»Ÿä¸€å¤„ç† <code>createTime</code>, <code>updateUser</code> ç­‰å…¬å…±å­—æ®µï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚
                    </p>
                </div>

                <div class="glass-panel p-6 rounded-xl bg-gradient-to-br from-white to-orange-50">
                    <div class="text-orange-500 text-3xl mb-4"><i class="fa-solid fa-tower-broadcast"></i></div>
                    <h4 class="font-bold text-lg mb-2">WebSocket æ¶ˆæ¯æ¨é€</h4>
                    <p class="text-sm text-slate-600 mb-2">å®ç°äº†å•†å®¶ç«¯çš„â€œè¯­éŸ³æ’­æŠ¥â€åŠŸèƒ½ã€‚</p>
                    <div class="flex space-x-2 mt-2">
                        <span class="px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded">Type=1 æ¥å•</span>
                        <span class="px-2 py-1 bg-red-100 text-red-700 text-xs rounded">Type=2 å‚¬å•</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-slate-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 py-6 text-center text-slate-500 text-sm">
            <p>Generated by Canvas Create Webapp | Based on Sky Take Out Project Report | AI Features Powered by Gemini</p>
        </div>
    </footer>

    <script>
        const apiKey = ""; // System provides key

        // --- Data Definitions ---

        // 1. Tech Stack Data
        const techStackData = {
            labels: ['Spring Boot (Core)', 'MySQL (Data)', 'Redis (Cache)', 'WebSocket (Push)', 'Aliyun OSS (Storage)', 'WeChat Pay (Payment)'],
            datasets: [{
                label: 'Tech Composition',
                data: [30, 20, 15, 15, 10, 10],
                backgroundColor: [
                    '#0ea5e9', // Sky 500
                    '#3b82f6', // Blue 500
                    '#ef4444', // Red 500 (Redis)
                    '#f97316', // Orange 500
                    '#10b981', // Emerald 500
                    '#22c55e'  // Green 500 (WeChat)
                ],
                borderWidth: 0,
                hoverOffset: 4
            }]
        };

        // 2. Feature Lists
        const features = {
            admin: [
                {
                    title: "å‘˜å·¥ç®¡ç†",
                    icon: "fa-users",
                    desc: "MD5åŠ å¯†ç™»å½•ï¼ŒJWTé‰´æƒã€‚æ”¯æŒå‘˜å·¥å¢åˆ æ”¹æŸ¥åŠè´¦å·çŠ¶æ€å¯ç”¨/ç¦ç”¨ã€‚",
                    color: "text-blue-500"
                },
                {
                    title: "èœå“ä¸å¥—é¤",
                    icon: "fa-utensils",
                    desc: "æ ¸å¿ƒæ•°æ®ç»´æŠ¤ã€‚æ”¯æŒå›¾ç‰‡ä¸Šä¼ (OSS)ã€å£å‘³è®¾ç½®ã€æ‰¹é‡åˆ é™¤åŠèµ·å”®åœå”®æ§åˆ¶ã€‚",
                    color: "text-green-500"
                },
                {
                    title: "è®¢å•å¤„ç†",
                    icon: "fa-clipboard-list",
                    desc: "æ¥å•ã€æ‹’å•ã€æ´¾é€ã€å®Œæˆã€‚æ”¯æŒæŒ‰å¤šæ¡ä»¶æœç´¢è®¢å•ã€‚",
                    color: "text-orange-500"
                },
                {
                    title: "æ•°æ®æŠ¥è¡¨",
                    icon: "fa-chart-line",
                    desc: "è¥ä¸šé¢ç»Ÿè®¡ã€è®¢å•å®Œæˆç‡ã€é”€é‡Top10ç»Ÿè®¡å¯è§†åŒ–ã€‚",
                    color: "text-purple-500"
                },
                {
                    title: "åº—é“ºçŠ¶æ€",
                    icon: "fa-store",
                    desc: "åŸºäºRedisç¼“å­˜åº—é“ºè¥ä¸šçŠ¶æ€ï¼Œä¸€é”®åˆ‡æ¢è¥ä¸š/æ‰“çƒŠã€‚",
                    color: "text-red-500"
                }
            ],
            user: [
                {
                    title: "å¾®ä¿¡ç™»å½•",
                    icon: "fa-comment",
                    desc: "è°ƒç”¨ jscode2session æ¥å£ï¼Œè·å– openidï¼Œæ–°ç”¨æˆ·è‡ªåŠ¨æ³¨å†Œã€‚",
                    color: "text-green-600"
                },
                {
                    title: "ç‚¹é¤æµç¨‹",
                    icon: "fa-cart-plus",
                    desc: "æµè§ˆèœå•ï¼ˆæ”¯æŒç¼“å­˜ï¼‰ï¼Œé€‰æ‹©è§„æ ¼å£å‘³ï¼ŒåŠ å…¥è´­ç‰©è½¦ã€‚",
                    color: "text-orange-500"
                },
                {
                    title: "ä¸‹å•æ”¯ä»˜",
                    icon: "fa-credit-card",
                    desc: "åœ°å€ç®¡ç†ï¼Œæäº¤è®¢å•ã€‚é›†æˆå¾®ä¿¡æ”¯ä»˜ï¼Œæ”¯ä»˜æˆåŠŸå›è°ƒé€šçŸ¥ã€‚",
                    color: "text-sky-500"
                },
                {
                    title: "è®¢å•äº¤äº’",
                    icon: "fa-bell",
                    desc: "æŸ¥çœ‹å†å²è®¢å•ã€‚æ”¯æŒå–æ¶ˆè®¢å•ã€å†æ¥ä¸€å•ã€ä¸€é”®å‚¬å•ã€‚",
                    color: "text-indigo-500"
                }
            ]
        };

        // 3. Order Flow Steps
        const orderSteps = [
            {
                title: "ç”¨æˆ·ä¸‹å• & æ”¯ä»˜",
                desc: "ç”¨æˆ·æäº¤è®¢å•ï¼Œç³»ç»Ÿæ ¡éªŒè´­ç‰©è½¦ä¸åœ°å€ã€‚è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£ã€‚æ”¯ä»˜æˆåŠŸå PayNotifyController æ›´æ–°çŠ¶æ€ä¸º 'å·²æ”¯ä»˜'ã€‚",
                tech: "Controller, Service, WeChat API",
                status: "PENDING_PAYMENT -> PAID"
            },
            {
                title: "å•†å®¶æ¥å• (WebSocket)",
                desc: "æ”¯ä»˜æˆåŠŸåï¼ŒæœåŠ¡å™¨é€šè¿‡ WebSocket æ¨é€ type=1 æ¶ˆæ¯ã€‚å•†å®¶ç«¯è¯­éŸ³æ’­æŠ¥ï¼Œç‚¹å‡» 'æ¥å•'ã€‚",
                tech: "WebSocketServer, OrderController",
                status: "TO_BE_CONFIRMED -> CONFIRMED"
            },
            {
                title: "é¤å“åˆ¶ä½œ & æ´¾é€",
                desc: "å•†å®¶åˆ¶ä½œå®Œæˆï¼Œç‚¹å‡» 'æ´¾é€'ã€‚åå°æ›´æ–°çŠ¶æ€ã€‚æ¯æ—¥å‡Œæ™¨ Spring Task è‡ªåŠ¨æ£€æŸ¥æœªå®Œæˆçš„æ´¾é€è®¢å•ã€‚",
                tech: "OrderController, Spring Task",
                status: "CONFIRMED -> DELIVERY_IN_PROGRESS"
            },
            {
                title: "è®¢å•å®Œæˆ",
                desc: "é€è¾¾åå•†å®¶æˆ–ç³»ç»Ÿæ ‡è®° 'å®Œæˆ'ã€‚ç”¨æˆ·å¯è¿›è¡Œè¯„ä»·æˆ–å†æ¥ä¸€å•ã€‚",
                tech: "MySQL Update",
                status: "COMPLETED"
            }
        ];

        // 4. Mock Statistics Data (For ReportController Visualization)
        const salesData = {
            labels: ['é¦™è¾£é¸¡ç¿…', 'å®«ä¿é¸¡ä¸', 'æ°´ç…®é±¼', 'éº»å©†è±†è…', 'æ‰¬å·ç‚’é¥­', 'é…¸èœé±¼', 'å¯ä¹'],
            datasets: [{
                label: 'é”€é‡ (ä»½)',
                data: [320, 280, 250, 210, 180, 150, 120],
                backgroundColor: 'rgba(14, 165, 233, 0.7)', // Sky 500 with opacity
                borderColor: '#0ea5e9',
                borderWidth: 1,
                borderRadius: 4
            }]
        };

        // --- Application Logic ---

        // View Switching
        function switchView(viewName) {
            // Hide all views
            ['dashboard', 'features', 'technical'].forEach(v => {
                document.getElementById(`${v}-view`).classList.add('hidden');
            });
            // Show selected
            document.getElementById(`${viewName}-view`).classList.remove('hidden');

            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active', 'text-white', 'bg-sky-500');
                el.classList.add('text-slate-600', 'hover:text-sky-500');
                if(el.getAttribute('onclick').includes(viewName)) {
                    el.classList.add('active', 'bg-sky-500', 'text-white');
                    el.classList.remove('text-slate-600', 'hover:text-sky-500');
                }
            });
        }

        // Toggle Admin/User Features
        function toggleFeature(type) {
            const adminGrid = document.getElementById('admin-features');
            const userGrid = document.getElementById('user-features');
            const btnAdmin = document.getElementById('btn-admin');
            const btnUser = document.getElementById('btn-user');

            const adminAI = document.getElementById('admin-ai-section');
            const userAI = document.getElementById('user-ai-section');

            if (type === 'admin') {
                adminGrid.classList.remove('hidden');
                userGrid.classList.add('hidden');
                adminAI.classList.remove('hidden');
                userAI.classList.add('hidden');

                btnAdmin.className = "px-4 py-2 rounded-md text-sm font-medium bg-sky-500 text-white shadow-sm transition-all";
                btnUser.className = "px-4 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 transition-all";
            } else {
                adminGrid.classList.add('hidden');
                userGrid.classList.remove('hidden');
                adminAI.classList.add('hidden');
                userAI.classList.remove('hidden');

                btnUser.className = "px-4 py-2 rounded-md text-sm font-medium bg-orange-500 text-white shadow-sm transition-all";
                btnAdmin.className = "px-4 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 transition-all";
            }
        }

        // Render Feature Cards
        function renderFeatures() {
            const createCard = (item) => `
                <div class="feature-card bg-white p-6 rounded-xl border border-slate-100 shadow-sm">
                    <div class="flex items-center mb-3">
                        <div class="p-2 rounded-lg bg-slate-50 mr-3">
                            <i class="fa-solid ${item.icon} ${item.color} text-xl"></i>
                        </div>
                        <h4 class="font-bold text-slate-800">${item.title}</h4>
                    </div>
                    <p class="text-sm text-slate-500 leading-relaxed">${item.desc}</p>
                </div>
            `;

            document.getElementById('admin-features').innerHTML = features.admin.map(createCard).join('');
            document.getElementById('user-features').innerHTML = features.user.map(createCard).join('');
        }

        // Render Order Flow
        function renderOrderFlow() {
            const container = document.getElementById('order-flow-container');
            container.innerHTML = orderSteps.map((step, index) => `
                <div class="relative">
                    <div class="absolute -left-[53px] top-1 bg-white border-2 border-sky-500 rounded-full w-6 h-6 flex items-center justify-center z-10">
                        <span class="text-xs font-bold text-sky-600">${index + 1}</span>
                    </div>
                    <div class="bg-white p-5 rounded-lg border border-slate-200 shadow-sm hover:border-sky-300 transition-colors">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-slate-800">${step.title}</h4>
                            <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded font-mono">${step.status}</span>
                        </div>
                        <p class="text-sm text-slate-600 mb-3">${step.desc}</p>
                        <div class="text-xs text-sky-600 font-semibold bg-sky-50 inline-block px-2 py-1 rounded">
                            <i class="fa-solid fa-code mr-1"></i> ${step.tech}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show Details Interaction
        function showDetail(type) {
            const box = document.getElementById('detail-box');
            const title = document.getElementById('detail-title');
            const content = document.getElementById('detail-content');

            box.classList.remove('hidden');
            box.classList.add('animate-pulse-once');

            if (type === 'admin-detail') {
                title.innerText = "ç®¡ç†ç«¯æ ¸å¿ƒèŒè´£";
                title.className = "font-bold text-lg mb-2 text-sky-600";
                content.innerHTML = "ç®¡ç†ç«¯ä¸»è¦ç”¨äºæ•°æ®çš„ç»´æŠ¤ï¼ˆCRUDï¼‰å’Œä¸šåŠ¡æµç¨‹çš„æ§åˆ¶ã€‚å®ƒåŒ…æ‹¬å‘˜å·¥ç®¡ç†ã€åˆ†ç±»/èœå“/å¥—é¤ç®¡ç†ï¼Œä»¥åŠæœ€é‡è¦çš„<strong>è®¢å•å¤„ç†æµç¨‹</strong>ï¼ˆæ¥å•ã€æ‹’å•ã€æ´¾é€ï¼‰ã€‚æ­¤å¤–ï¼Œé€šè¿‡ ReportController æä¾›è¥ä¸šé¢å’Œé”€é‡çš„ç»Ÿè®¡æŠ¥è¡¨ã€‚";
            } else if (type === 'user-detail') {
                title.innerText = "ç”¨æˆ·ç«¯æ ¸å¿ƒä½“éªŒ";
                title.className = "font-bold text-lg mb-2 text-orange-500";
                content.innerHTML = "ç”¨æˆ·ç«¯åŸºäºå¾®ä¿¡å°ç¨‹åºï¼Œé€šè¿‡ UserService.wxLogin å®ç°æ— æ„Ÿç™»å½•ã€‚æ ¸å¿ƒæµç¨‹å›´ç»•<strong>ç‚¹é¤</strong>å±•å¼€ï¼šæµè§ˆç¼“å­˜èœå• -> è´­ç‰©è½¦ç®¡ç† -> æäº¤è®¢å• -> å¾®ä¿¡æ”¯ä»˜ã€‚æ”¯ä»˜å›è°ƒæ˜¯è¿æ¥ç”¨æˆ·ä¸å•†å®¶çš„å…³é”®èŠ‚ç‚¹ã€‚";
            }
        }

        // Initialize Charts
        function initCharts() {
            // 1. Tech Stack Chart
            const ctx1 = document.getElementById('techStackChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: techStackData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { font: { family: "'Inter', sans-serif" }, boxWidth: 12 }
                        }
                    }
                }
            });

            // 2. Sales Report Chart
            const ctx2 = document.getElementById('salesChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: salesData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Horizontal Bar
                    scales: {
                        x: { beginAtZero: true, grid: { display: false } },
                        y: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` é”€é‡: ${context.raw} ä»½`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Gemini AI Logic ---

        async function callGemini(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) throw new Error('API Request Failed');

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("AI Error:", error);
                return "AI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚";
            }
        }

        // Feature 1: Admin Data Insights
        async function generateAdminInsights() {
            const btnText = document.getElementById('admin-ai-btn-text');
            const loader = document.getElementById('admin-ai-loader');
            const output = document.getElementById('admin-ai-output');

            btnText.textContent = "åˆ†æä¸­...";
            loader.classList.remove('hidden');
            output.innerHTML = "<span class='text-slate-400'>æ­£åœ¨åˆ†æé”€å”®æ•°æ®è¶‹åŠ¿...</span>";

            // Prepare Data Summary
            const summary = salesData.labels.map((label, index) => `${label}: ${salesData.datasets[0].data[index]}ä»½`).join(', ');
            const prompt = `ä½ æ˜¯ä¸€ä¸ªé¤é¥®ç®¡ç†ä¸“å®¶ã€‚ä»¥ä¸‹æ˜¯è‹ç©¹å¤–å–ç³»ç»Ÿçš„è¿‘æœŸèœå“é”€é‡æ•°æ®ï¼š${summary}ã€‚è¯·ç”Ÿæˆä¸€ä»½ç®€çŸ­çš„è¿è¥æ´å¯ŸæŠ¥å‘Šï¼ˆä¸­æ–‡ï¼‰ã€‚åŒ…å«ï¼š1. é”€é‡å† å†›ç‚¹è¯„ã€‚2. æ½œåŠ›èœå“åˆ†æã€‚3. ä¸€æ¡é’ˆå¯¹æ€§çš„è¥é”€å»ºè®®ã€‚ä½¿ç”¨ Markdown æ ¼å¼ï¼Œä¸è¦åŠ ç²—ã€‚`;

            const result = await callGemini(prompt);

            output.innerHTML = result.replace(/\n/g, '<br>');
            btnText.textContent = "âœ¨ é‡æ–°ç”Ÿæˆ";
            loader.classList.add('hidden');
        }

        // Feature 2: User Dish Recommendation
        async function getDishRecommendation() {
            const input = document.getElementById('user-preference-input').value;
            if (!input.trim()) return;

            const btnText = document.getElementById('user-ai-btn-text');
            const loader = document.getElementById('user-ai-loader');
            const output = document.getElementById('user-ai-output');

            btnText.textContent = "æ€è€ƒä¸­...";
            loader.classList.remove('hidden');

            const menu = salesData.labels.join(', ');
            const prompt = `ä½ æ˜¯ä¸€ä¸ªå¤–å–APPçš„æ™ºèƒ½æ¨èåŠ©æ‰‹ã€‚æˆ‘ä»¬çš„èœå•ä¸Šæœ‰ï¼š${menu}ã€‚ç”¨æˆ·è¯´ï¼šâ€œ${input}â€ã€‚è¯·ä»èœå•ä¸­æ¨è1-2æ¬¾æœ€åˆé€‚çš„èœå“ï¼Œå¹¶ç”¨è¯±äººçš„è¯­è¨€ç®€çŸ­æè¿°æ¨èç†ç”±ï¼ˆä¸­æ–‡ï¼‰ã€‚è¯­æ°”è¦çƒ­æƒ…äº²åˆ‡ã€‚`;

            const result = await callGemini(prompt);

            output.innerHTML = result.replace(/\n/g, '<br>');
            btnText.textContent = "âœ¨ AI æ¨è";
            loader.classList.add('hidden');
        }

        // --- Init ---
        window.addEventListener('DOMContentLoaded', () => {
            renderFeatures();
            renderOrderFlow();
            initCharts();
        });

    </script>
</body>
</html>